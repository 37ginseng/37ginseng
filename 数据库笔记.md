# 基础操作

## mysql服务的启动与关闭

管理员打开cmd,输入:

```
->net start mysql  #回车, 启动mysql服务
->net stop mysql 回车,  关闭mysql服务
```




## 登录MySQL

->mysql  -u账号  -p密码 -h主机名/IP  - P端口号 -d数据库名

或:mysql -u用户名 -p密码  数据库名

进入mysql之后所有的命令以分号结尾, 回车执行!



## 查看/创建/使用/插入/删除/修改

### 查看当前数据库管理系统中所有的数据库

mysql>show  databases;	

**查看指定数据库的创建信息**

```
show create database 数据库名;如:

mysql> show create database mydb;
```

**查看当前所在数据库**

```
select database();
```

**查询数据**

```
# 方式1 查看所有数据
select * from 数据表名;
# 方式2 查询部分
select {字段名1,字段名2,字段名3...} from 数据表名;
# 方式3 简单条件查询
select * | {字段名1,字段名2,字段名3,...} from 数据表名 where 字段名=值
# 方式4 asc 升序 desc 降序 
SELECT field1, field2,...fieldN FROM table_name1, table_name2...
ORDER BY field1 [ASC [DESC][默认 ASC]], [field2...] [ASC [DESC][默认 ASC]]
-- select * from commodity order by id asc
```

**查询数据语法框架**

```
select...
from...
where...
group by...分组
having... 拥有
order by...排序
limit ... 限制,如显示个数
max()最大
min()最小
average()平均
count()计数
sum()求和
```



**查看数据表的字段信息**

```
# 语法格式1
{describe | desc } 数据表名;
# 语法格式2 查看部分
{describe | desc} 数据表名 字段名;
# 语法格式1 不加full与desc相同
show [full] columns from 数据表名 [from 数据库];
# 语法格式2 
show [full] columns from 数据库名.数据表名;
```

**查看数据表的创建语句**
mysql>show create table 表名称;
如:

```
mysql>show create table student;
CREATE TABLE `student` (
  `sid` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL,
  `major` varchar(20) NOT NULL,
  `sex` char(2) NOT NULL,
  `age` int(11) NOT NULL,
  PRIMARY KEY (`sid`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
```

<!--乱码问题产生的根源:是存储编码和显示编码不一致造成的.如果服务器的编码字符集是utf8,那么此时你是要Navicat去进行操作(窗口操作/或命令行操作)都会是正常的.-->
**查看当前的编号环境:**

```
mysql> show variables like '%character%';
```

**查看警告信息**

```
mysql> show warnings;
```

**查看数据表**

```
show tables [like 匹配模式];如:
mysql> show tables like '%n%';
```



### 创建数据库,名称b200201

create  database  b200201;	# create database b200201;

mysql>CREATE DATABASE IF NOT EXISTS mydb;
<!--解释:如果存在数据库mydb,就不创建,也不会报错! 否则就创建.-->

创建数据表:

create [temporary] table [if not exists ] 表名 # temporary 表示临时表

(字段名 字段类型 [字段属性]...) [表选项]

**创建一张表,名称是student**

```
create table student(
    sid       int   primary key  auto_increment,
    name   varchar(20) not null,
    major   varchar(20) not null,
    sex       char(2) not null,
    age      int not null
);

```

### 要使用的数据库

use b200201;



### 插入一条数据到表中

```
# 方式1 为所有字段添加数据
insert [into] 数据表名 {values | value} (值1[,值2]...);
mysql>insert into student values(1,'程灵素','药学','女',22);
---------
#方式2 部分 有些不能为空
insert [into] 数据表名 (字段名1[,字段名2]...)
{values | value} (值1[,值2]...);
---------------
#方式3 部分 MYSQL提供
insert [into] 数据表名
set 字段名1=值1 [,字段名2=值2]...;
--------------------
# 方式4 一次添加多行数据
insert [into] 数据表名 [(字段列表)] {values | value} (值列表)[,(值列表)]...;
```

**新增字段**

```
# 语法格式 1: 新增一个字段 ,并可以指定其位置
alter table 数据表名
add [column] 新字段名 字段类型 [first | after 字段名]
# 语法格式 2: 同时新增多个字段
alter table 数据表名
add [column] (新字段名1,字段类型,新字段名2,字段类型,...)
```



###  删除一张表

```
mysql>drop [temporary] table [if exists] 数据表1 [,数据表2]...;
```

**删除字段**

```
alter table 数据表名 drop [column] 字段名;
```

**删除数据库:**

```
DROP DATABASE IF EXISTS mydb; # drop database if exists mydb
```

**删除数据**

```
delete from 数据表名 [where 条件表达式];
```



### 修改数据表的名称:

```
# 语法格式1
alter table 旧表名 rename [to|as] 新表名
# 语法格式2
rename table 旧表名 1 to 新表名 1 [, 旧表名2 to 新表名2 ...]

```

**修改表选项**

```
alter table 表名 表选项 [=] 值;
```

**修改字段名**

```
alter table 数据表名 change [column] 旧字段名 新字段名 字段类型 [字段属性];
```

**修改字段类型**

```
alter table 数据表名 modify [column] 字段名 新类型 [字段属性];
```

**修改字段的位置**

alter table 数据表名 modify [column] 字段名1 数据类型 [字段属性] [first | after 字段名2];

----

### 更新数据

```
update 数据表名 set 字段名1=值1,[,字段名2=值2,...] [where 条件表达式];
```



## 注释

```
-- 单行注释  (注意--后面有个空格, 别忘了!)
# 单行注释
/* 多行注释 */
```

含关键字(group)的字段创建:

```
create table t1 (id int , `group` char(10));
```

# 数据类型与约束

​	int	整型数据
​	float  小数类型
​	decimal(7,2)  精确小数
​	char(4)   定长字符串
​	varchar(20)  变长字符串
​	time   时分秒
​	date   年月日
​	datetime  年月日时分秒
​	binary   图片,音频, 视频

## 数字类型

### **整形数据**

```
tinyint (1) # 字节数为一

smallint(2)

mediumint(3)

int (4)

bigint (8)
# 显示长度与取值范围无关;符号占一宽度;零填充:zerofill.
```

### 浮点数类型

```
float(4) #字节数为4 精度为6位或7位,

double (8) # 精度约15位
```

### 定点数类型

```
decimal(m,d)设置位数(不包括.和-)和精度
```

### bit类型

```
-- 获取字符a的ASCII码
select ascii('a')
-- 将十进制装换为二进制,并计算长度
select bin(65) ,length(bin(65))
```

### 时间和日期类型

**year类型**

```
create table my_year (y year);

insert into my_yeat values (2020);
```

**date类型**

```
create table my_date(d date);
insert into my_date values
 ('20210331'),
 (current_date),
 (now());
```

**time类型**

**datetime类型**

**timestamp类型**   --  null或无输入,保存系统当前时间

## 字符串类型

**char 和 varchar**  --定长  可变长度(占用字节=实际长度+1)

**text类型**  -- tinytext 	 text	 mediumtext	 longtext 

**enum类型**

```
 create table my_enum (gender enum('male','female'));
 -- 能且只能从枚举列表中取一个
 insert into my_enum values ('male');
```

**set类型**

```
create table my_set (hobby,set('book','game','code'));
insert into my_set values('book,game');
```

**binary和 varbinary类型**

```
 create table  my_binary (b1 binary(4),b2 varbinary(4));
 insert into my_binary values('acb','xyz');
```

**blob类型**

```
create table my_blob (b blob);
 insert into my_blob values ('date');
 -- tinyblob 2^8-1 blob 2^16-1 mediumblob 2^24-1 longblob 2^32-1
```

**json类型**

```
create table my_json (j1 json,j2 json);
-- json数组['abc',10,null,true,false]类似Python列表
-- json对象{"k1":"value","k2":10}类似Python字典
insert into my_json values('['abc',10,null,true,false]','{"k1":"value","k2":10}');
```

## 表的约束

### 默认约束 default

给约束的属性(列)一个默认值;  在插入数据时,如果忽略就使用默认值

```
语法格式: 字段名 数据名 default 默认值;
create table my_default(
 name varchar(10),
 age int unsigned default 18
);
```

**删除/添加默认约束**/非空约束

```
删除:	alter table my_default modify age int unsigned
添加:	alter table my_default modify name varchar(10) default "三七" 
-- 实质为重定义该字段的默认约束属性(或非空约束)
```



### 非空约束not null

指字段不能为null

```
语法格式: 字段名 数据类型 not null;
create table my_not_null(
 n1 int,
 n2 int not null,
 n3 int not null default 18
 );
```



### 唯一约束 unique

保证字段的值不重复

```
#列级约束
字段名 数据类型 unique
------------------------
create table my_unique1 (
 id int unsigned unique,
 username varchar(10) unique
);
----------------------------
# 表级约束
unique (字段名1,字段名2,...)
create table my_unique2(
 id int unsigned ,
 username varchar(10) ,
 unique(id),
 unique(username)
)
------------------------------------
# 复合约束	只有多个字段的值相同时才视为重复记录
create table my_unique4(
 id int unsigned ,username varchar(10),
 unique(id,username)
);
-------------------------------------------------
# 完整形式
unique key 索引名 (字段列表)
create table my_unique_6 (
 id int ,
 name varchar(20) not null,
 unique key name (name),
 primary key id (id)
);
```

**添加和删除唯一性约束,无法通过修改字段属性的方式操作**

```
alter table my_unique_3 add unique(id);
alter table my_unique_3 drop index id;
```



### 主键约束primary key

```
#主键可以唯一标识表中的记录,复合主键需要多个字段来确定一条记录的唯一性
#列级约束
字段名 数据类型 primary key 
create table my_primary(
 id int unsigned primary key,
 username varchar(20)
);
# 表级约束 
primary key (字段名1,字段名2,...)

```

**添加/删除主键**

```
#删除主键约束,非空约束没有被同时删除
alter table my_primary drop primary key;
# 添加主键约束
alter table my_primary add primary key (id);
```



### 外键约束 foreign key 

外键约束是指在一个表中引用另一个表的一列或多列,被引用的列应该具有主键约束或唯一约束,从而保证数据的一致性和完整性.

建立外键关系的两个字段数据类型要求可以相互转换

#### **添加外键约束语法格式**

```
[constraint symbol] foreign key [index_name] (index_col_name,...) 
references table_name (index_col_name,...)
[on delete {restrict | cascade | set null | no action | set default}]
[on update {restrict | cascade | set null | no action | set default}]
```

| 参数列表    | 功能描述                                                |
| ----------- | ------------------------------------------------------- |
| restrict    | 默认值. 拒绝主表删除或修改外键关联字段                  |
| cascade     | 主表删除或更新记录时,同时自动删除或更新从表中对应的记录 |
| set null    | 主表中删除或更新记录时,使用null值替换从表中对应的记录   |
| no action   | 与默认值restict相同,拒绝主表删除或修改外键关联字段      |
| set default | 设默认值 ,但 InnoDB目前不支持                           |



**建表时添加外键**

```
create table department(
 dept_id int unsigned primary key auto_increment comment"部门编号",
 name varchar(50) not null comment'员工姓名'
) default charset=utf8;
create table emloyees(
 id int unsigned primary key auto_increment comment"员工编号",
 name varchar(120) not null comment"员工姓名",
 dept_id int unsigned not null comment"部门编号",
 constraint fk_id foreign key (dept_id) references department(dept_id)
 on delete restrict on update cascade
)default charset=utf8;
```



**alter talbe 时添加外键**

```
alter talbe employees
add comstraint Fk_id foreign key(dept_id) referenced department(dept_id)
on delete restrict on update cascade;
```



#### 删除外键约束

```
alter table talbe_name drop foreign key fk_name;
```

删除外键约束时不会自动删除系统创建的普通索引,key值依然为mul

**删除系统为外键删除的普通索引**

```
alter table employees drop key fk_id;
```



#### **查看外键约束**

```
desc employees dept_id ; # key 为 mul
show create table employees \G # 详细信息
```



#### **关联表操作**

**添加数据**

​	-- 一个具有外键约束的从表在插入数据时,外键字段的值会手主表数据的约束:

从表外键字段插入的值必须选取主表中相关联字段已经存在的数据



**更新数据**

​	-- 对主表进行更新操作,从表将按照其建立外键约束时设置的on update 参数自动执行相应的操作.



**删除数据**

​	-- 对主表进行删除操作,从表将按照其建立外键约束时设置的on delete 参数自动执行相应的操作.

​	-- 使用district时,主表中每条记录的删除,都要保证从表中没有相关记录的对应数据.因此,一般用set null ,同时保证从表中对应的外键字段允许为空.

## 自动增长

```
语法格式: 字段名 数据类型 auto_increment
------------
create table my_auto(
 id int unsigned primary key auto_increment,
 username varchar(20)
);
```

**修改自动增长**

```
alter table my_auto auto_increment=10;
```

**删除自动增长**

```
alter table my_auto modify id int unsigned; 
```

**添加自动增长**

```
alter table my_auto modify id int unsigned auto_increment; # 只能有一个自动列，并且必须将它定义为键
```



------

# 结束符、字符集、校对集

### 概念

```
SQL通常以';'  结尾,也可以用'\g'结尾,效果与' ; '相同.

以'\G'结尾,将显示结果纵向排列,适合字段非常多的情况.

**字符集**: 一系列字符的编码规则

**校对集**: 不同字符的比较和排序规则.
```



### 查看字符集和校对集

```
# 查看字符集
show character set
# 查看校对集
show collation
# 查看当前会话的字符集
show variables like 'character%';
```

### **修改字符集** 

-- 只对当前会话有效

```
set character_set_client=gbk;

set character_set_conection=gbk;

set character_set_results=gbk;
或:
set name gbk;
```



### 创建时设置字符集和校对集

创建数据库时设立字符集和校对集

```
[default] character set [=] charset_name

[default ] collate [=] collation_name
如:
create database mydb_1 character set utf8;
```

创建数据表时字符集和校对集和设定

```
[default] character set [=] charset_name
[default] collate [=] collation_name
示例:
create table my_charset(
 username varchar(20)
)character set = utf8 collate = utf8_bin;
```

字段的字符集和校对集在字段属性中设定

[character set charset_name] [collate collation_name]

示例:

```
create table my_charset_3(
username varchar(20)  character set utf8 collate  utf8_bin unique
);
```





# 日志

**2021年6月4日14:35:54**

mysql> create user 'dbman'@ 'localhost' identified by '123';
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''localhost' identified by '123'' at line 1
mysql> create user "dbman"@"localhost" identified by '123';
Query OK, 0 rows affected (0.03 sec)

mysql> grant all privileges on mydb.* to 'dbman'@'localhost' ;
Query OK, 0 rows affected (0.01 sec)
grant all privileges on *.* to 'dbman'@'localhost' identified by '123' WITH GRANT 
		OPTION;
		

